<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sản phẩm</title>
    <link rel="stylesheet" href="San-pham-2.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="San-pham-2.js"></script>
</head>

<body class="body-padding">
    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm fixed-top">
            <div class="container">
                <a class="navbar-brand text-dark fw-bold fs-3" href="#">DREAMS HOME</a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link text-uppercase" href="/index.html">Giới thiệu</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link fw-bold dropdown-toggle text-uppercase" href="#" id="navbarDropdown"
                                role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Sản phẩm
                            </a>
                            <ul class="dropdown-menu border-top border-primary border-3"
                                aria-labelledby="navbarDropdown">
                                <li><a class="dropdown-item" href="San-pham-1.html">Chăn</a></li>
                                <li><a class="dropdown-item" href="San-pham-1.html">Gối</a></li>
                                <li><a class="dropdown-item" href="San-pham-1.html">Nệm</a></li>
                                <li><a class="dropdown-item" href="San-pham-1.html">Combo</a></li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-uppercase" href="/Gio-hang/Gio-hang.html"><i
                                    class="fas fa-shopping-cart"></i> Giỏ hàng</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-uppercase" href="/Gio-hang/history.html"> Lịch sử đơn hàng</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-uppercase" href="/login-main/index_login.html" id="login-link">
                                <i class="fas fa-user me-1"></i> Đăng nhập
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <section class="product-info">
        <div class="pInfo">
            <img id="productImage" class="product-image" src="" alt="">

            <div class="info-area">
                <ul>
                    <li>
                        <h3 id="productName"></h3>
                        <hr>
                    </li>
                    <li id="productPrice"></li>
                    <li>4.9 <i class="fa-solid fa-star"></i></li>
                </ul>

                <div class="buy-section">
                    <div class="quantity-box">
                        <button class="qty-btn" onclick="changeQty(-1)">-</button>
                        <input type="number" id="quantity" value="1" min="1">
                        <button class="qty-btn" onclick="changeQty(1)">+</button>
                    </div>

                    <div class="action-buttons">
                        <button id="addCartBtn" class="add-cart">Thêm vào giỏ</button>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <section class="description">
        <div class="product-description">
            <h3>Thông tin sản phẩm</h3>
            <div class="product-description-box">
                <p id="productDesc" class="desc-text"></p>
            </div>
        </div>
    </section>



    </section>
    <footer class="bg-dark text-white text-center py-4 mt-5">
        <div class="container">
            <p class="mb-0 fs-6">&copy; 2025 Dreams Home. Luxury Bedding.</p>
        </div>
    </footer>

</body>
<script>
    //image slideshow

    function changeQty(num) {
        let qty = document.getElementById("quantity");
        let value = parseInt(qty.value) + num;

        if (value < 1) value = 1;
        qty.value = value;
    }
</script>
<script src="login-checking.js"></script>
<script src="animation.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCxZiG2atJ0QXFZq0afg__t_VkMO-RGRvQ",
        authDomain: "hungnhe1-d394c.firebaseapp.com",
        databaseURL: "https://hungnhe1-d394c-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "hungnhe1-d394c",
        storageBucket: "hungnhe1-d394c.firebasestorage.app",
        messagingSenderId: "840678788906",
        appId: "1:840678788906:web:a41f28793a3dcc021c1853"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

</script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        // đảm bảo firebase đã init trước khi đến đây
        const params = new URLSearchParams(window.location.search);
        const productId = params.get("id");

        // UI elements
        const elName = document.getElementById("productName");
        const elImg = document.getElementById("productImage");
        const elPrice = document.getElementById("productPrice");
        const elDesc = document.getElementById("productDesc");
        const addBtn = document.getElementById("addCartBtn");

        // helper safe-set
        const safeText = (el, txt) => { if (el) el.textContent = txt ?? ""; };

        if (!productId) {
            console.error("Không có productId trong URL. Ví dụ URL phải kèm ?id=PRODUCT_KEY");
            safeText(elName, "Không tìm thấy sản phẩm");
            if (elDesc) elDesc.textContent = "Vui lòng kiểm tra đường dẫn (thiếu id).";
            if (addBtn) addBtn.disabled = true;
            return;
        }

        const productRef = db.ref("products/" + productId);

        productRef.on("value", snapshot => {
            if (!snapshot.exists()) {
                console.warn("Không tìm thấy sản phẩm tại đường dẫn:", "products/" + productId);
                safeText(elName, "Sản phẩm không tồn tại");
                if (elDesc) elDesc.textContent = "Sản phẩm đã bị xóa hoặc id không đúng.";
                if (elImg) elImg.src = "";
                if (addBtn) addBtn.disabled = true;
                return;
            }

            const sp = snapshot.val();
            console.log("Product loaded:", sp);

            // Lấy mô tả thử nhiều tên trường thường dùng
            const desc = sp.desc ?? sp.description ?? sp.detail ?? sp.info ?? sp.mota ?? "";

            // Gán ra UI (kiểm tra tồn tại element trước khi gán)
            safeText(elName, sp.name ?? "Tên sản phẩm");
            if (elImg) elImg.src = sp.img ?? sp.image ?? "";
            safeText(elPrice, sp.price ? (Number(sp.price).toLocaleString() + " đ") : "");
            if (elDesc) elDesc.textContent = desc || "Chưa có mô tả cho sản phẩm này.";

            // lưu sản phẩm cho nút Thêm vào giỏ
            window.currentProduct = sp;

            // bật nút thêm nếu có sản phẩm
            if (addBtn) addBtn.disabled = false;
        }, err => {
            console.error("Lỗi khi đọc productRef:", err);
            safeText(elName, "Lỗi tải sản phẩm");
            if (elDesc) elDesc.textContent = "Không thể tải dữ liệu (xem console).";
            if (addBtn) addBtn.disabled = true;
        });

        // Add to cart (dùng window.currentProduct do trên đã lưu)
        if (addBtn) {
            addBtn.addEventListener("click", () => {
                const qty = parseInt(document.getElementById("quantity").value) || 1;
                const sp = window.currentProduct;
                if (!sp) {
                    alert("Sản phẩm chưa sẵn sàng, hãy thử tải lại trang.");
                    return;
                }

                let cart = JSON.parse(localStorage.getItem("cart")) || [];
                const index = cart.findIndex(item => item.id === productId);

                if (index >= 0) {
                    cart[index].qty = (cart[index].qty || 0) + qty;
                } else {
                    cart.push({
                        id: productId,
                        name: sp.name || "",
                        price: Number(sp.price) || 0,
                        img: sp.img || sp.image || "",
                        qty: qty
                    });
                }

                localStorage.setItem("cart", JSON.stringify(cart));

                window.location.href = "/Gio-hang/Gio-hang.html";
            });
  }
});

</script>
<script src="login-checking.js"></script>


</html>